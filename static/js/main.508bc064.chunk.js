(this.webpackJsonpechecs=this.webpackJsonpechecs||[]).push([[0],{33:function(e,t,n){e.exports=n(70)},38:function(e,t,n){},67:function(e,t){},70:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(31),i=n.n(o),c=(n(38),n(1)),s=n(2),l=n(4),u=n(3),p=n(5),m=n(32),d=n.n(m),h=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"start",value:function(t,n,a,r){var o=window.location.href,i=new URL(o).searchParams.get("server");if(null===i)return e.connecting=!1,void n();window.history.replaceState({server:"server"},"",window.location.href.split("%3A").join(":").split("%2F").join("/")),e.socket=d()(i),e.socket.on("connect",(function(){e.connected=!0,e.connecting=!1,t()})),e.socket.on("disconnect",(function(){e.socket.disconnect(),e.connected=!1,e.connecting=!1,r(i.split("%3A").join(":").split("%2F").join("/"))})),e.socket.on("connect_error",(function(){e.socket.disconnect(),e.connected=!1,e.connecting=!1,a(i.split("%3A").join(":").split("%2F").join("/"))}))}},{key:"removeAllListeners",value:function(t){e.getSocket()&&e.getSocket().removeAllListeners(t)}},{key:"on",value:function(t,n){e.getSocket()&&e.socket.on(t,(function(e){return n(e)}))}},{key:"send",value:function(t,n){e.getSocket()&&e.getSocket().emit(t,n)}},{key:"getSocket",value:function(){return e.socket}}]),e}();h.socket=null,h.connected=!1,h.connecting=!0;var f=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).change=function(e){n.setState({input:e.target.value})},n.sendPseudo=function(e){e.preventDefault(),n.state.input.length<3||""===n.state.input[0]||n.state.input.length>15||h.send("join",{name:n.state.input})},n.ask=function(e){h.send("ask",{name:e})},n.state={input:"",players:[]},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;h.on("players",(function(t){return e.setState({players:t.players})})),h.send("updatePlayers")}},{key:"componentWillUnmount",value:function(){h.removeAllListeners("players")}},{key:"getPlayersElements",value:function(){var e=this;return this.state.players.map((function(t,n){return r.a.createElement("li",{key:n},r.a.createElement("span",null,t.name),r.a.createElement("span",null,t.inGame?"En jeu":"En attente",r.a.createElement("button",{onClick:function(){return e.ask(t.name)},disabled:t.inGame},t.asked?"Rejoindre":"Inviter")))}))}},{key:"render",value:function(){var e=this;return r.a.createElement("section",{id:"players"},r.a.createElement("div",null,e.props.name?r.a.createElement("div",{className:"players"},r.a.createElement("h2",null,"Joueurs"),r.a.createElement("p",null,"Conn\xe9ct\xe9 en tant que ",e.props.name),r.a.createElement("ul",{id:"playersInQueueList"},e.getPlayersElements())):r.a.createElement("section",null,r.a.createElement("h2",null,"Choisissez votre pseudo"),r.a.createElement("form",{method:"GET",action:"",className:"usernameForm"},r.a.createElement("input",{className:e.props.nameError?"error error--border":null,autoFocus:!0,type:"text",name:"username",placeholder:"Pseudo",value:e.state.input,onChange:e.change}),r.a.createElement("p",{className:"error"},e.props.nameError),r.a.createElement("button",{type:"submit",onClick:e.sendPseudo,name:"validate"},"Rejoindre")))))}}]),t}(r.a.Component),v=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(){h.getSocket().emit("clickSquare",{id:n.props.id})},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{onClick:this.onClick,ref:this.props.elementRef,className:"square "+this.props.color+(this.props.glow?" glow":"")+(this.props.selected?" selected":"")+(this.props.attacked?" attacked":"")+(this.props.echec?" echec":"")+(this.props.roque?" roque":"")})}}]),t}(r.a.Component),E=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"setElement",value:function(t){e.element=t}},{key:"getElement",value:function(){return e.element}},{key:"setGetSquareFunction",value:function(t){e.getSquareElementByLocation=t}},{key:"setCallback",value:function(t){e.callback=t}},{key:"onClickStart",value:function(t){t.target.classList.contains("wrapper")&&(e.last[0]=t.pageY||t.changedTouches[0].pageY,e.last[1]=t.pageX||t.changedTouches[0].pageX,e.callback())}},{key:"onMove",value:function(t){if(e.last.length&&e.callback){var n="mousemove"===t.type?[t.pageY,t.pageX]:[t.changedTouches[0].pageY,t.changedTouches[0].pageX],a=e.last[0]-n[0],r=e.last[1]-n[1];"mousemove"===t.type&&(r/=2),e.rotation.x+=a/2,e.last[0]=n[0],e.rotation.z+=r/2,e.last[1]=n[1],e.rotation.x>55&&(e.rotation.x=55),e.rotation.x<0&&(e.rotation.x=0),e.isTimeout||(e.isTimeout=!0,setTimeout((function(){e.callback(),e.isTimeout=!1}),10))}}},{key:"onClickEnd",value:function(t){e.last=[],e.moveX=!1,e.moveZ=!1,e.callback()}},{key:"getPicecStyle",value:function(t){var n=e.getSquareElementByLocation(t).current.getBoundingClientRect(),a=e.element.getBoundingClientRect(),r={backgroundSize:6*n.width+"px "+2*n.width+"px",top:n.top+n.height/2-n.width+n.width/3-a.top+"px",left:n.left-a.left+10+"px",width:n.width-20+"px",zIndex:Math.round(n.top)};return e.last.length&&(r.transition="none"),r}},{key:"getStyle",value:function(){return{transform:"rotateX("+e.rotation.x+"deg) rotateZ("+e.rotation.z+"deg) scale(0.65)"}}}]),e}();E.element=null,E.last=[],E.callback=function(){},E.rotation={x:55,z:0},E.isTimeout=!1,E.getSquareElementByLocation=function(){};var k=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"setElement",value:function(t){e.element=t,e.resizeListener()}},{key:"getElement",value:function(){return e.element}},{key:"setSquareContainerElement",value:function(t){e.squareElement=t,e.resizeListener()}},{key:"getSquareContainerElement",value:function(){return e.squareElement}},{key:"onResize",value:function(t){e.callback=t}},{key:"getContainerWidth",value:function(){if(!e.squareElement)return 0;var t=e.squareElement.clientWidth,n=e.squareElement.clientHeight;return Math.min(t,n)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e.element){var a=getComputedStyle(this.element),r=this.element.clientHeight,o=this.element.clientWidth;return r-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),{width:(o-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight))/t*n,height:r/t*n}}return{width:816/t*n,height:816/t*n}}},{key:"resizeListener",value:function(){e.callback(),setTimeout((function(){e.callback(),e.isTimeout=!1}),150)}}]),e}();k.element=null,k.squareElement=null,k.callback=function(){},k.isTimeout=!1;var y=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).getSquareElementByLocation=function(e){return n.state.squares.find((function(t){return t.location.x===e.x&&t.location.y===e.y})).elementRef},n.state={squares:[]},n.tableElement=r.a.createRef(),E.setGetSquareFunction(n.getSquareElementByLocation);for(var a=0,o=0;o<8;o++)for(var i=0;i<8;i++)n.state.squares.push({id:a,elementRef:r.a.createRef(),location:{x:i,y:o},color:i%2-o%2?"black":"white"}),a++;return n.props.reverse&&n.state.squares.reverse(),n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){k.setElement(this.tableElement.current)}},{key:"render",value:function(){var e=this;return r.a.createElement("section",{id:"plateau",ref:this.tableElement,style:E.getStyle(),className:this.props.display3d?"transform":""},this.state.squares.map((function(t,n){var a=e.props.tableProperties.find((function(e){return e.id===t.id})),o=!1,i=!1,c=!1,s=!1,l=!1;return a&&(a.selected?o=!0:a.glow?i=!0:a.roque?c=!0:a.attacked?s=!0:a.echec&&(l=!0)),r.a.createElement(v,{key:n,elementRef:t.elementRef,id:t.id,display3d:e.props.display3d,selected:o,roque:c,glow:i,echec:l,attacked:s,location:t.location,color:t.color})})),r.a.createElement("div",{className:"numbers"},function(){for(var e=[],t=0;t<8;t++)e.push(r.a.createElement("span",{key:t},t+1));return e}()),r.a.createElement("div",{className:"letters"},function(){for(var e=[],t=0;t<8;t++)e.push(r.a.createElement("span",{key:t},String.fromCharCode(t+65)));return e}()))}}]),t}(r.a.Component),g=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).onClick=function(){n.props.clicked&&n.props.clicked(n.props.id)},n.type||(n.type=n.props.type),n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.location?this.props.location:{x:0,y:0};this.props.reverse&&!this.props.display3d&&(e={x:7-this.props.location.x,y:7-this.props.location.y});var t={backgroundSize:k.getSize(8,6).width+"px "+k.getSize(8,2).width+"px",top:e.y*k.getSize(8).width+20+"px",left:e.x*k.getSize(8).width+20+"px",width:k.getSize(8).width+"px",height:k.getSize(8).width+"px"};return r.a.createElement("span",{onClick:this.onClick,className:"piece "+this.props.color+" "+this.type+(this.props.display3d?" display3d":""),style:this.props.display3d?E.getPicecStyle(e):t})}}]),t}(r.a.Component),b=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(e){n.props.transform(e)},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("section",{id:"choosePane"},r.a.createElement("div",null,r.a.createElement("h2",null,"En quoi voullez-vous transformer le pion ?"),r.a.createElement("div",null,r.a.createElement("div",null,function(){for(var t=[],n=0,a=["reine","fou","tour","cavalier"];n<a.length;n++){var o=a[n];t.push(r.a.createElement(j,{key:t.length,color:e.props.color,onClick:e.onClick,type:o}))}return t}()))))}}]),t}(r.a.Component),j=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"square",onClick:function(){e.props.onClick(e.props.type)}},r.a.createElement(g,{type:this.props.type,color:this.props.color}))}}]),t}(r.a.Component),O=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("section",{id:"choosePane"},r.a.createElement("div",null,r.a.createElement("h2",null,this.props.title),r.a.createElement("p",null,this.props.message),r.a.createElement("button",{onClick:this.props.quit},"Retour au salon")))}}]),t}(r.a.Component),S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).clickPiece=function(e){h.send("clickPiece",{id:e})},n.plateau=r.a.createRef(),n.squareElement=r.a.createRef(),n.wrapperElement=r.a.createRef(),n.toUpdate=0,n.state={transformOpen:!1,pieces:[],tableProperties:[],end:!1,endTitle:"",endMessage:""},h.on("tableUpdate",(function(e){return n.setState({tableProperties:e.tableProperties})})),h.on("update",(function(e){return n.setState({pieces:e.pieces,tableProperties:e.tableProperties,transformOpen:!1})})),h.on("transform",(function(e){return n.setState({transformOpen:!0})})),h.on("end",(function(e){n.setState({end:!0,endTitle:e.title,endMessage:e.message})})),n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;k.setSquareContainerElement(this.squareElement.current),E.setElement(this.wrapperElement.current),k.onResize((function(){return e.forceUpdate()})),E.setCallback((function(){e.forceUpdate(),e.toUpdate++})),this.forceUpdate()}},{key:"componentDidUpdate",value:function(){this.toUpdate>0&&(this.toUpdate--,this.forceUpdate())}},{key:"transform",value:function(e){h.send("transform",{type:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("section",{id:"squareContainer",ref:this.squareElement},r.a.createElement("section",{id:"game",style:{width:k.getContainerWidth()+"px",height:k.getContainerWidth()+"px"},onContextMenu:function(e){return e.preventDefault()},onTouchStart:E.onClickStart,onTouchMove:E.onMove,onTouchEnd:E.onClickEnd,onMouseDown:E.onClickStart,onMouseMove:E.onMove,onMouseUp:E.onClickEnd,className:this.props.team},r.a.createElement("div",{id:"tableContainer",ref:this.tableElement},r.a.createElement("section",{ref:this.wrapperElement,className:"wrapper "+this.props.team},r.a.createElement(y,{reverse:"black"===this.props.team,display3d:this.props.display3d,game:this,ref:this.plateau,tableProperties:this.state.tableProperties}),this.state.pieces.map((function(t){var n=t.location;return r.a.createElement(g,{reverse:"black"===e.props.team,display3d:e.props.display3d,key:t.id,id:t.id,type:t.type,location:n,color:t.color,clicked:e.clickPiece})})))),this.state.end?r.a.createElement(O,{quit:this.props.quit,title:this.state.endTitle,message:this.state.endMessage}):null,this.state.transformOpen&&!this.state.end?r.a.createElement(b,{transform:function(t){return e.transform(t)},color:this.props.team}):null))}}]),t}(r.a.Component),w=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).change=function(e){n.setState({input:e.target.value})},n.state={input:"http://"},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("section",{id:"players"},r.a.createElement("div",null,r.a.createElement("section",null,r.a.createElement("h2",null,"Connexion \xe0 un serveur sur le r\xe9seau local"),r.a.createElement("form",{method:"GET",action:"./",className:"usernameForm"},r.a.createElement("input",{autoFocus:!0,type:"text",name:"server",placeholder:"Adresse du serveur",value:this.state.input,onChange:this.change}),r.a.createElement("button",{type:"submit"},"Connexion")),r.a.createElement("p",null,"Ou t\xe9l\xe9chargez un serveur local pour"),r.a.createElement("a",{href:"chess-lan-server-macos",download:!0},"MacOS x 64"),r.a.createElement("a",{href:"chess-lan-server-windows.exe",download:!0},"Windows x 64"))))}}]),t}(r.a.Component),C=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).change=function(e){n.setState({input:e.target.value})},n.state={input:e.url},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("section",{id:"players"},r.a.createElement("div",null,r.a.createElement("section",null,r.a.createElement("h2",{className:"error"},"Erreur !"),r.a.createElement("p",{className:"error"},this.props.message),r.a.createElement("h3",null,"R\xe9ssayer"),r.a.createElement("form",{method:"GET",action:"./",className:"usernameForm"},r.a.createElement("input",{className:"error error--border",autoFocus:!0,type:"text",name:"server",placeholder:"Adresse du serveur",value:this.state.input,onChange:this.change}),r.a.createElement("button",{type:"submit"},"Connexion")))))}}]),t}(r.a.Component),q=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).quit=function(){n.setState({started:!1,team:"white",display3d:!1})},n.state={started:!1,team:"white",nameError:null,display3d:!1,name:null,needAskServer:!1,unknownServer:null,disconnect:null},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;h.start((function(){h.on("nameError",(function(t){return e.setState({nameError:t.error})})),h.on("name",(function(t){return e.setState({name:t.name})})),h.on("start",(function(t){return e.setState({started:!0,team:t.team})})),e.forceUpdate()}),(function(){return e.setState({needAskServer:!0})}),(function(t){return e.setState({unknownServer:t})}),(function(t){return e.setState({disconnect:t})}))}},{key:"render",value:function(){var e=this;return h.connecting?r.a.createElement("main",null):this.state.disconnect?r.a.createElement("main",null,r.a.createElement(C,{url:this.state.disconnect,message:'Communication avec le serveur interrompue ("'+this.state.disconnect+'")'})):this.state.started?r.a.createElement("main",null,r.a.createElement("div",{className:"can-toggle"},r.a.createElement("input",{id:"e",type:"checkbox",onChange:function(t){return e.setState({display3d:t.target.checked})}}),r.a.createElement("label",{htmlFor:"e","data-checked":"3D","data-unchecked":"2D"},r.a.createElement("div",null))),r.a.createElement(S,{quit:this.quit,team:this.state.team,display3d:this.state.display3d})):this.state.needAskServer?r.a.createElement("main",null,r.a.createElement(w,null)):this.state.unknownServer?r.a.createElement("main",null,r.a.createElement(C,{url:this.state.unknownServer,message:'Impossible de se connecter au serveur ("'+this.state.unknownServer+'")'})):r.a.createElement("main",null,r.a.createElement(f,{nameError:this.state.nameError,name:this.state.name}))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));window.addEventListener("resize",k.resizeListener),i.a.render(r.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[33,1,2]]]);
//# sourceMappingURL=main.508bc064.chunk.js.map